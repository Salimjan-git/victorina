<!-- templates/subjects/create.html -->
{% extends "base.html" %}

{% block title %}–≠“∑–æ–¥–∏ —Ñ–∞–Ω–∏ –Ω–∞–≤{% endblock %}

{% block content %}
<div class="container py-4">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">–î–∞—à–±–æ—Ä–¥</a></li>
            <li class="breadcrumb-item"><a href="{% url 'subject_list' %}">–§–∞–Ω“≥–æ</a></li>
            <li class="breadcrumb-item active">–≠“∑–æ–¥–∏ –Ω–∞–≤</li>
        </ol>
    </nav>
    
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-plus-circle me-2"></i>
                        –≠“∑–æ–¥–∏ —Ñ–∞–Ω–∏ –Ω–∞–≤
                    </h4>
                </div>
                
                <div class="card-body p-4">
                    <form method="post" id="subjectForm" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <!-- Basic Information -->
                        <div class="mb-4">
                            <h5 class="mb-3 border-bottom pb-2">
                                <i class="fas fa-info-circle me-2 text-primary"></i>
                                –ú–∞—ä–ª—É–º–æ—Ç–∏ –∞—Å–æ—Å”£
                            </h5>
                            
                            <div class="mb-3">
                                <label for="id_name" class="form-label fw-bold">–ù–æ–º–∏ —Ñ–∞–Ω</label>
                                <input type="text" class="form-control form-control-lg" 
                                       id="id_name" name="name" required
                                       placeholder="–ú–∞—Å–∞–ª–∞–Ω: –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞, –ó–∞–±–æ–Ω–∏ —Ç–æ“∑–∏–∫”£, –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞">
                                <div class="form-text">–ù–æ–º–∏ –ø—É—Ä—Ä–∞–∏ —Ñ–∞–Ω—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥</div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="id_code" class="form-label fw-bold">–†–∞–º–∑–∏ —Ñ–∞–Ω</label>
                                    <input type="text" class="form-control" 
                                           id="id_code" name="code"
                                           placeholder="–ú–∞—Å–∞–ª–∞–Ω: MATH101, TJV101, INF101">
                                    <div class="form-text">–†–∞–º–∑–∏ –∫”Ø—Ç–æ“≥–∏ —Ñ–∞–Ω –±–∞—Ä–æ–∏ –º—É–∞–π—è–Ω –∫–∞—Ä–¥–∞–Ω–∏ –æ—Å–æ–Ω</div>
                                </div>
                                
                                <div class="col-md-6">
                                    <label for="id_grade_level" class="form-label fw-bold">–°–∏–Ω—Ñ–∏ —Ç–∞“≥—Å–∏–ª”£</label>
                                    <select class="form-select" id="id_grade_level" name="grade_level">
                                        <option value="" selected>–ë–∞—Ä–æ–∏ “≥–∞–º–∞ —Å–∏–Ω—Ñ“≥–æ</option>
                                        <option value="1">–°–∏–Ω—Ñ–∏ 1</option>
                                        <option value="2">–°–∏–Ω—Ñ–∏ 2</option>
                                        <option value="3">–°–∏–Ω—Ñ–∏ 3</option>
                                        <option value="4">–°–∏–Ω—Ñ–∏ 4</option>
                                        <option value="5">–°–∏–Ω—Ñ–∏ 5</option>
                                        <option value="6">–°–∏–Ω—Ñ–∏ 6</option>
                                        <option value="7">–°–∏–Ω—Ñ–∏ 7</option>
                                        <option value="8">–°–∏–Ω—Ñ–∏ 8</option>
                                        <option value="9">–°–∏–Ω—Ñ–∏ 9</option>
                                        <option value="10">–°–∏–Ω—Ñ–∏ 10</option>
                                        <option value="11">–°–∏–Ω—Ñ–∏ 11</option>
                                        <option value="university">–î–æ–Ω–∏—à–≥–æ“≥</option>
                                        <option value="other">–î–∏–≥–∞—Ä</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="id_description" class="form-label fw-bold">–¢–∞–≤—Å–∏—Ñ–∏ —Ñ–∞–Ω</label>
                                <textarea class="form-control" id="id_description" name="description" 
                                          rows="4" placeholder="–¢–∞–≤—Å–∏—Ñ–∏ –º—É—Ñ–∞—Å—Å–∞–ª–∏ —Ñ–∞–Ω—Ä–æ –¥–∞—Ä –∏–Ω “∑–æ –Ω–∞–≤–∏—Å–µ–¥..."></textarea>
                                <div class="form-text">–¢–∞–≤—Å–∏—Ñ–∏ —Ñ–∞–Ω –±–∞ –¥–æ–Ω–∏—à“∑”Ø—ë–Ω –≤–∞ –æ–º”Ø–∑–≥–æ—Ä–æ–Ω –∫”Ø–º–∞–∫ –º–µ–∫—É–Ω–∞–¥</div>
                            </div>
                        </div>
                        
                        <!-- Visual Customization -->
                        <div class="mb-4">
                            <h5 class="mb-3 border-bottom pb-2">
                                <i class="fas fa-palette me-2 text-primary"></i>
                                –¢–∞–Ω–∑–∏–º–æ—Ç–∏ –≤–∏–∑—É–∞–ª”£
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="id_color" class="form-label fw-bold">–†–∞–Ω–≥–∏ —Ñ–∞–Ω</label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" 
                                               id="id_color" name="color" value="#4361ee" title="–†–∞–Ω–≥—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥">
                                        <input type="text" class="form-control" id="colorHex" value="#4361ee" readonly 
                                               style="max-width: 100px;">
                                    </div>
                                    <div class="form-text">–ò–Ω —Ä–∞–Ω–≥ –¥–∞—Ä –∫–æ—Ä—Ç“≥–æ –≤–∞ –≥—Ä–∞—Ñ–∏–∫“≥–æ –∏—Å—Ç–∏—Ñ–æ–¥–∞ –º–µ—à–∞–≤–∞–¥</div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="id_icon" class="form-label fw-bold">–ò–∫–æ–Ω–∞–∏ —Ñ–∞–Ω</label>
                                    <select class="form-select" id="id_icon" name="icon">
                                        <option value="fas fa-book" selected>üìö –ö–∏—Ç–æ–±</option>
                                        <option value="fas fa-calculator">üßÆ “≤–∏—Å–æ–±–±–∞—Ä–æ—Ä</option>
                                        <option value="fas fa-laptop-code">üíª –ë–∞—Ä–Ω–æ–º–∞—Å–æ–∑”£</option>
                                        <option value="fas fa-flask">üß™ –ö–∏–º–∏—ë</option>
                                        <option value="fas fa-globe-asia">üåè –ì–µ–æ–≥—Ä–∞—Ñ–∏—è</option>
                                        <option value="fas fa-history">üìú –¢–∞—ä—Ä–∏—Ö</option>
                                        <option value="fas fa-language">üî§ –ó–∞–±–æ–Ω</option>
                                        <option value="fas fa-music">üéµ –ú—É—Å–∏“õ”£</option>
                                        <option value="fas fa-paint-brush">üé® –°–∞–Ω—ä–∞—Ç</option>
                                        <option value="fas fa-dumbbell">üèãÔ∏è –í–∞—Ä–∑–∏—à</option>
                                        <option value="fas fa-atom">‚öõÔ∏è –§–∏–∑–∏–∫–∞</option>
                                        <option value="fas fa-seedling">üå± –ë–∏–æ–ª–æ–≥–∏—è</option>
                                    </select>
                                    <div class="form-text">–ò–∫–æ–Ω–∞ –±–∞—Ä–æ–∏ –Ω–∞–º–æ–∏—à–∏ —Ñ–∞–Ω –¥–∞—Ä –¥–∞—à–±–æ—Ä–¥</div>
                                </div>
                            </div>
                            
                            <!-- Icon Preview -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">–ù–∞–º—É–Ω–∞–∏ –∏–∫–æ–Ω–∞</label>
                                <div class="border rounded p-3 text-center bg-light">
                                    <div id="iconPreview" class="d-inline-block p-3 rounded-circle" 
                                         style="background-color: #4361ee20;">
                                        <i class="fas fa-book fa-3x text-primary"></i>
                                    </div>
                                    <div class="mt-2">
                                        <span id="iconName" class="fw-bold">–ö–∏—Ç–æ–±</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Course Settings -->
                        <div class="mb-4">
                            <h5 class="mb-3 border-bottom pb-2">
                                <i class="fas fa-cog me-2 text-primary"></i>
                                –¢–∞–Ω–∑–∏–º–æ—Ç–∏ –∫—É—Ä—Å
                            </h5>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" 
                                               id="id_is_public" name="is_public" checked>
                                        <label class="form-check-label fw-bold" for="id_is_public">
                                            –§–∞–Ω–∏ –æ–º–º–∞–≤”£
                                        </label>
                                        <div class="form-text">–ê–≥–∞—Ä —Ñ–∞—ä–æ–ª –±–æ—à–∞–¥, “≥–∞–º–∞ –∫–æ—Ä–±–∞—Ä–æ–Ω –º–µ—Ç–∞–≤–æ–Ω–∞–Ω–¥ –±–∞ —Ñ–∞–Ω –Ω–æ–º–Ω–∞–≤–∏—Å”£ –∫—É–Ω–∞–Ω–¥</div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" 
                                               id="id_requires_approval" name="requires_approval">
                                        <label class="form-check-label fw-bold" for="id_requires_approval">
                                            –¢–∞–ª–æ—à –±–∞—Ä–æ–∏ —Ç–∞—Å–¥–∏“õ
                                        </label>
                                        <div class="form-text">–ê–≥–∞—Ä —Ñ–∞—ä–æ–ª –±–æ—à–∞–¥, –Ω–æ–º–Ω–∞–≤–∏—Å”£ –±–æ—è–¥ –∞–∑ “∑–æ–Ω–∏–±–∏ –æ–º”Ø–∑–≥–æ—Ä —Ç–∞—Å–¥–∏“õ –∫–∞—Ä–¥–∞ —à–∞–≤–∞–¥</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="id_max_students" class="form-label fw-bold">“≤–∞–¥–¥–∏ –∞–∫—Å–∞—Ä –¥–æ–Ω–∏—à“∑”Ø—ë–Ω</label>
                                    <input type="number" class="form-control" 
                                           id="id_max_students" name="max_students" min="0" value="0">
                                    <div class="form-text">0 –±–∞—Ä–æ–∏ –Ω–æ–º–∞“≥–¥—É–¥. –ë–∞—Ä–æ–∏ –º—É“õ–∞—Ä—Ä–∞—Ä –∫–∞—Ä–¥–∞–Ω–∏ “≥–∞–¥–¥–∏ –∞–∫—Å–∞—Ä –¥–æ–Ω–∏—à“∑”Ø—ë–Ω</div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="id_pass_percentage" class="form-label fw-bold">–§–æ–∏–∑–∏ –≥—É–∑–∞—Ä–∏—à</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" 
                                               id="id_pass_percentage" name="pass_percentage" 
                                               min="0" max="100" value="60">
                                        <span class="input-group-text">%</span>
                                    </div>
                                    <div class="form-text">–ú–∏“õ–¥–æ—Ä–∏ –º–∏–Ω–∏–º–∞–ª–∏–∏ –±–∞—Ä–æ–∏ –≥—É–∑–∞—à—Ç–∞–Ω –∞–∑ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞</div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="id_prerequisites" class="form-label fw-bold">–ü–µ—à–Ω–∏—ë–∑“≥–æ</label>
                                <textarea class="form-control" id="id_prerequisites" name="prerequisites" 
                                          rows="2" placeholder="–û–º”Ø–∑–∏—à–∏ –∫–∞–¥–æ–º –º–∞–≤–æ–¥“≥–æ –ø–µ—à–Ω–∏“≥–æ–¥ –∫–∞—Ä–¥–∞ –º–µ—à–∞–≤–∞–¥?"></textarea>
                                <div class="form-text">–ú–∞—ä–ª—É–º–æ—Ç–µ, –∫–∏ –¥–æ–Ω–∏—à“∑”Ø—ë–Ω –ø–µ—à –∞–∑ –Ω–æ–º–Ω–∞–≤–∏—Å”£ –±–æ—è–¥ –±–∏–¥–æ–Ω–∞–Ω–¥</div>
                            </div>
                        </div>
                        
                        <!-- Learning Objectives -->
                        <div class="mb-4">
                            <h5 class="mb-3 border-bottom pb-2">
                                <i class="fas fa-bullseye me-2 text-primary"></i>
                                –ú–∞“õ—Å–∞–¥“≥–æ–∏ –æ–º”Ø–∑–∏—à”£
                            </h5>
                            
                            <div class="mb-3">
                                <div id="objectivesContainer">
                                    <div class="objective-item input-group mb-2">
                                        <input type="text" class="form-control" name="objectives" 
                                               placeholder="–ú–∞—Å–∞–ª–∞–Ω: –û–º”Ø–∑–∏—à–∏ –∞—Å–æ—Å“≥–æ–∏ –∞–ª–≥–µ–±—Ä–∞">
                                        <button type="button" class="btn btn-outline-danger remove-objective">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <button type="button" class="btn btn-outline-primary btn-sm" id="addObjective">
                                    <i class="fas fa-plus me-1"></i> –ò–ª–æ–≤–∞–∏ –º–∞“õ—Å–∞–¥–∏ –Ω–∞–≤
                                </button>
                                <div class="form-text">–ú–∞“õ—Å–∞–¥“≥–æ–∏ –æ–º”Ø–∑–∏—à”£ –±–∞ –¥–æ–Ω–∏—à“∑”Ø—ë–Ω –∫”Ø–º–∞–∫ –º–µ–∫—É–Ω–∞–¥, –∫–∏ —á”£ —á–∏–∑“≥–æ—Ä–æ –æ–º”Ø—Ö—Ç–∞–Ω–¥</div>
                            </div>
                        </div>
                        
                        <!-- Submit Buttons -->
                        <div class="d-flex justify-content-between pt-3 border-top">
                            <a href="{% url 'subject_list' %}" class="btn btn-outline-secondary">
                                <i class="fas fa-times me-2"></i> –ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω
                            </a>
                            
                            <div class="btn-group">
                                <button type="submit" name="save_draft" class="btn btn-outline-primary">
                                    <i class="fas fa-save me-2"></i> –ó–∞—Ö–∏—Ä–∞–∏ –Ω–æ–ø—É—Ä—Ä–∞
                                </button>
                                <button type="submit" name="publish" class="btn btn-primary">
                                    <i class="fas fa-check-circle me-2"></i> –≠“∑–æ–¥ –≤–∞ –Ω–∞—à—Ä
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Tips Card -->
            <div class="card shadow-sm mt-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0">
                        <i class="fas fa-lightbulb me-2 text-warning"></i>
                        –ú–∞—Å–ª–∏“≥–∞—Ç“≥–æ –±–∞—Ä–æ–∏ —ç“∑–æ–¥–∏ —Ñ–∞–Ω–∏ –º—É–≤–∞—Ñ—Ñ–∞“õ
                    </h6>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            –ù–æ–º–∏ —Ñ–∞–Ω–∏ —Ä–∞–≤—à–∞–Ω –≤–∞ –º—É–∞–π—è–Ω—Ä–æ –∏—Å—Ç–∏—Ñ–æ–¥–∞ –±–∞—Ä–µ–¥
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            –¢–∞–≤—Å–∏—Ñ–∏ —Ñ–∞–Ω–∏ –º—É—Ñ–∞—Å—Å–∞–ª –±–∞ –¥–æ–Ω–∏—à“∑”Ø—ë–Ω –∫”Ø–º–∞–∫ –º–µ–∫—É–Ω–∞–¥, –∫–∏ –º–∞–≤–æ–¥“≥–æ—Ä–æ —Ñ–∞“≥–º–∞–Ω–¥
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            –ú–∞“õ—Å–∞–¥“≥–æ–∏ –æ–º”Ø–∑–∏—à”£ –±–∞—Ä–æ–∏ –º—É–∞–π—è–Ω –∫–∞—Ä–¥–∞–Ω–∏ –Ω–∞—Ç–∏“∑–∞“≥–æ–∏ –∏–Ω—Ç–∏–∑–æ—Ä”£ –º—É“≥–∏–º –∞—Å—Ç
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            –ü–µ—à –∞–∑ –Ω–∞—à—Ä, –º–∞—ä–ª—É–º–æ—Ç–∏ —Ñ–∞–Ω–∏ —Ö—É–¥—Ä–æ –¥—É–±–æ—Ä–∞ –±–∞—Ä—Ä–∞—Å”£ –∫—É–Ω–µ–¥
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">–ü–µ—à–Ω–∞–º–æ–∏—à–∏ —Ñ–∞–Ω</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="previewContent">
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">–û–º–æ–¥–∞ –∫–∞—Ä–¥–∞ –º–µ—à–∞–≤–∞–¥...</span>
                        </div>
                        <p class="mt-3">–ü–µ—à–Ω–∞–º–æ–∏—à –æ–º–æ–¥–∞ –∫–∞—Ä–¥–∞ –º–µ—à–∞–≤–∞–¥...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.form-control-color {
    width: 60px;
    height: 45px;
    padding: 0.375rem;
}

.objective-item .form-control {
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
}

.objective-item .remove-objective {
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
}

.border-bottom {
    border-bottom: 2px solid #dee2e6 !important;
}

.form-control-lg {
    font-size: 1.1rem;
    padding: 0.75rem 1rem;
}

.form-switch .form-check-input {
    width: 3em;
    height: 1.5em;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Update color hex value
    $('#id_color').on('input', function() {
        $('#colorHex').val($(this).val());
        $('#iconPreview').css('background-color', $(this).val() + '20');
        $('#iconPreview i').css('color', $(this).val());
    });
    
    // Update icon preview
    $('#id_icon').change(function() {
        const selectedIcon = $(this).val();
        const iconClass = selectedIcon.split(' ')[1];
        let iconName = '';
        
        // Map icon classes to names
        const iconNames = {
            'fa-book': '–ö–∏—Ç–æ–±',
            'fa-calculator': '“≤–∏—Å–æ–±–±–∞—Ä–æ—Ä',
            'fa-laptop-code': '–ë–∞—Ä–Ω–æ–º–∞—Å–æ–∑”£',
            'fa-flask': '–ö–∏–º–∏—ë',
            'fa-globe-asia': '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è',
            'fa-history': '–¢–∞—ä—Ä–∏—Ö',
            'fa-language': '–ó–∞–±–æ–Ω',
            'fa-music': '–ú—É—Å–∏“õ”£',
            'fa-paint-brush': '–°–∞–Ω—ä–∞—Ç',
            'fa-dumbbell': '–í–∞—Ä–∑–∏—à',
            'fa-atom': '–§–∏–∑–∏–∫–∞',
            'fa-seedling': '–ë–∏–æ–ª–æ–≥–∏—è'
        };
        
        for (const key in iconNames) {
            if (iconClass.includes(key)) {
                iconName = iconNames[key];
                break;
            }
        }
        
        $('#iconPreview i').attr('class', selectedIcon + ' fa-3x');
        $('#iconName').text(iconName);
    });
    
    // Add/remove learning objectives
    $('#addObjective').click(function() {
        const newObjective = `
            <div class="objective-item input-group mb-2">
                <input type="text" class="form-control" name="objectives" 
                       placeholder="–ú–∞—Å–∞–ª–∞–Ω: –û–º”Ø–∑–∏—à–∏ –∞—Å–æ—Å“≥–æ–∏ –≥–µ–æ–º–µ—Ç—Ä–∏—è">
                <button type="button" class="btn btn-outline-danger remove-objective">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `;
        $('#objectivesContainer').append(newObjective);
    });
    
    // Remove objective (delegated event)
    $('#objectivesContainer').on('click', '.remove-objective', function() {
        if ($('#objectivesContainer .objective-item').length > 1) {
            $(this).closest('.objective-item').remove();
        } else {
            alert('“≤–∞–¥–¥–∏ –∞“õ–∞–ª —è–∫ –º–∞“õ—Å–∞–¥ –±–æ—è–¥ –±–æ—à–∞–¥');
        }
    });
    
    // Form validation
    $('#subjectForm').submit(function(e) {
        const name = $('#id_name').val().trim();
        const description = $('#id_description').val().trim();
        
        if (!name) {
            e.preventDefault();
            showAlert('–õ—É—Ç—Ñ–∞–Ω –Ω–æ–º–∏ —Ñ–∞–Ω–∏—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥', 'danger');
            $('#id_name').focus();
            return false;
        }
        
        if (name.length < 3) {
            e.preventDefault();
            showAlert('–ù–æ–º–∏ —Ñ–∞–Ω –±–æ—è–¥ “≥–∞–¥–¥–∏ –∞“õ–∞–ª 3 “≥–∞—Ä—Ñ –¥–æ—à—Ç–∞ –±–æ—à–∞–¥', 'danger');
            $('#id_name').focus();
            return false;
        }
        
        if (!description) {
            if (!confirm('–®—É–º–æ —Ç–∞–≤—Å–∏—Ñ–∏ —Ñ–∞–Ω—Ä–æ –≤–æ—Ä–∏–¥ –Ω–∞–∫–∞—Ä–¥–µ–¥. –û—ë –º—É—Ç–º–∞–∏–Ω “≥–∞—Å—Ç–µ–¥, –∫–∏ –º–µ—Ö–æ“≥–µ–¥ –∏–¥–æ–º–∞ –¥–∏“≥–µ–¥?')) {
                e.preventDefault();
                return false;
            }
        }
        
        // Validate pass percentage
        const passPercentage = parseInt($('#id_pass_percentage').val());
        if (passPercentage < 0 || passPercentage > 100) {
            e.preventDefault();
            showAlert('–§–æ–∏–∑–∏ –≥—É–∑–∞—Ä–∏—à –±–æ—è–¥ –±–∞–π–Ω–∏ 0 –≤–∞ 100 –±–æ—à–∞–¥', 'danger');
            $('#id_pass_percentage').focus();
            return false;
        }
        
        return true;
    });
    
    // Preview functionality
    $('#previewBtn').click(function() {
        $('#previewModal').modal('show');
        
        // Get form data
        const formData = {
            name: $('#id_name').val() || '–ù–∞–º—É–Ω–∞–∏ —Ñ–∞–Ω',
            code: $('#id_code').val() || 'CODE101',
            description: $('#id_description').val() || '–¢–∞–≤—Å–∏—Ñ–∏ —Ñ–∞–Ω –≤—É“∑—É–¥ –Ω–∞–¥–æ—Ä–∞–¥',
            grade_level: $('#id_grade_level option:selected').text(),
            color: $('#id_color').val(),
            icon: $('#id_icon').val()
        };
        
        // Generate preview
        setTimeout(function() {
            $('#previewContent').html(`
                <div class="card" style="border-left: 5px solid ${formData.color}">
                    <div class="card-body">
                        <div class="d-flex align-items-start mb-3">
                            <div class="rounded-circle p-3 me-3" 
                                 style="background-color: ${formData.color}20; color: ${formData.color}">
                                <i class="${formData.icon} fa-2x"></i>
                            </div>
                            <div>
                                <h4 class="card-title">${formData.name}</h4>
                                <h6 class="card-subtitle text-muted">${formData.code} | ${formData.grade_level}</h6>
                            </div>
                        </div>
                        
                        <p class="card-text">${formData.description}</p>
                        
                        <div class="row mt-4">
                            <div class="col-6">
                                <div class="text-center">
                                    <div class="display-6 fw-bold text-primary">0</div>
                                    <small class="text-muted">–í–∏–∫—Ç–æ—Ä–∏–Ω–∞“≥–æ</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center">
                                    <div class="display-6 fw-bold text-success">0</div>
                                    <small class="text-muted">–°–∞–≤–æ–ª“≥–æ</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-info mt-3">
                            <i class="fas fa-info-circle me-2"></i>
                            –ò–Ω —Ç–∞–Ω“≥–æ –ø–µ—à–Ω–∞–º–æ–∏—à –∞—Å—Ç. –ë–∞—Ä–æ–∏ —ç“∑–æ–¥–∏ —Ñ–∞–Ω, —Ç—É–≥–º–∞–∏ "–≠“∑–æ–¥ –≤–∞ –Ω–∞—à—Ä"-—Ä–æ –ø–∞—Ö—à –∫—É–Ω–µ–¥.
                        </div>
                    </div>
                </div>
            `);
        }, 500);
    });
    
    // Auto-generate code from name
    $('#id_name').on('blur', function() {
        if (!$('#id_code').val()) {
            const name = $(this).val().trim();
            if (name.length >= 3) {
                // Generate code (first 3 letters + 101)
                const code = name.substring(0, 3).toUpperCase() + '101';
                $('#id_code').val(code);
            }
        }
    });
    
    // Alert function
    function showAlert(message, type) {
        const alertHtml = `
            <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                <i class="fas fa-${type === 'danger' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `;
        
        // Remove any existing alerts
        $('.alert').remove();
        
        // Add new alert at the top of form
        $('#subjectForm').prepend(alertHtml);
        
        // Auto remove after 5 seconds
        setTimeout(function() {
            $('.alert').alert('close');
        }, 5000);
    }
    
    // Set up preview button (if exists)
    $('<button type="button" class="btn btn-outline-info me-2" id="previewBtn">' +
      '<i class="fas fa-eye me-2"></i>–ü–µ—à–Ω–∞–º–æ–∏—à</button>')
      .insertBefore('button[name="save_draft"]');
});
</script>
{% endblock %}